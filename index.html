<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Fast Money â€“ Live Multiplayer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{--bg:#000;--accent:#72f090;--text:#eaffef;--dark:#001100;--panel:#071b11}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif}
.board{width:1280px;max-width:100%;margin:30px auto;padding:30px;background:linear-gradient(#083a1f,#0a6b3b);border-radius:16px;border:12px solid rgba(0,0,0,.7);position:relative}
.rows{margin-top:120px;display:flex;flex-direction:column;gap:12px}
.row{display:flex;gap:16px}
.slot{flex:1;height:56px;background:#001100;border-radius:10px;overflow:hidden}
.slot .text{padding:14px;transform:translateX(-100%);transition:.4s}
.slot.revealed .text{transform:translateX(0)}
.num{width:100px;background:black;color:white;display:flex;align-items:center;justify-content:center}
.panel{max-width:1200px;margin:30px auto;background:#071b11;padding:30px;border-radius:16px}
</style>
</head>

<body>
<div id="app"></div>

<script>
/* ===== SUPABASE ===== */
const SUPABASE_URL = "https://vqinyfvbqmjiiuwhxazc.supabase.co";
const SUPABASE_KEY = "sb_publishable_MMcFkbkALlweCQ2sp23kJw_92PbVZHk";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ===== MODE ===== */
const mode = new URLSearchParams(location.search).get("mode") || "overlay";

/* ===== STATE ===== */
let state = {
  rows: Array.from({length:10},(_,i)=>({
    text:"Answer "+(i+1),
    score:(10-i)*10,
    revealedText:false,
    revealedScore:false
  })),
  timer:{remaining:30,running:false}
};

/* ===== SEND ===== */
async function send(msg){
  await supabase.from("fastmoney").update({state:msg}).eq("id",1);
}

/* ===== RECEIVE ===== */
supabase.channel("fastmoney")
.on("postgres_changes",{event:"UPDATE",schema:"public",table:"fastmoney"},payload=>{
  const d = payload.new.state;
  if(!d) return;

  if(d.type==="update"){ state=d.state; render(); }
  if(d.type==="revealText"){ state.rows[d.i].revealedText=true; render(); }
  if(d.type==="revealScore"){ state.rows[d.i].revealedScore=true; render(); }
  if(d.type==="timer"){ state.timer=d.timer; render(); }
})
.subscribe();

/* ===== LOAD SAVED STATE ===== */
(async()=>{
  const {data} = await supabase.from("fastmoney").select("state").eq("id",1).single();
  if(data?.state?.state){ state=data.state.state; render(); }
})();

/* ===== RENDER ===== */
function render(){
  if(mode==="control") renderControl();
  else renderOverlay();
}

function renderOverlay(){
  app.innerHTML = `
  <div class="board">
    ${state.rows.map(r=>`
      <div class="row">
        <div class="slot ${r.revealedText?'revealed':''}">
          <div class="text">${r.text}</div>
        </div>
        <div class="num">${r.revealedScore?r.score:""}</div>
      </div>`).join("")}
  </div>`;
}

function renderControl(){
  app.innerHTML = `
  <div class="panel">
    ${state.rows.map((r,i)=>`
      <input value="${r.text}" oninput="state.rows[${i}].text=this.value">
      <input type="number" value="${r.score}" oninput="state.rows[${i}].score=this.value">
      <button onclick="send({type:'revealText',i:${i}})">Text</button>
      <button onclick="send({type:'revealScore',i:${i}})">#</button><br>
    `).join("")}
    <br>
    <button onclick="send({type:'update',state})">UPDATE</button>
  </div>`;
}

render();
</script>
</body>
</html>
